---
import BaseLayout from '../../layouts/BaseLayout.astro';
---

<BaseLayout title="ูุธุงู ุงูููุงุท - ูููุน ZH Love">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- ุงูุนููุงู ุงูุฑุฆูุณู -->
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold text-foreground mb-4">๐ ูุธุงู ุงูููุงุท ูุงูุชุฑุชูุจ</h1>
            <p class="text-muted-foreground text-lg">ุชุนุฑู ุนูู ููููุฉ ุญุณุงุจ ุงูููุงุท ูุชุฑุชูุจ ุงูุนุดุงุฆุฑ</p>
        </div>

        <!-- ุดุฑุญ ูุธุงู ุงูููุงุท -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
            <div class="military-card p-6">
                <h2 class="text-2xl font-bold text-tactical-green mb-4">๐ฏ ููู ูุชู ุญุณุงุจ ุงูููุงุทุ</h2>
                <div class="space-y-4 text-foreground">
                    <div class="flex items-start gap-3">
                        <div class="w-6 h-6 bg-tactical-green rounded-full flex items-center justify-center text-white text-sm font-bold">1</div>
                        <div>
                            <h3 class="font-semibold mb-1">ุงูููุงุท ุงูุฃุณุงุณูุฉ</h3>
                            <p class="text-muted-foreground text-sm">ุชุนุชูุฏ ุนูู ููุน ุงูุญุฑุจ ุงููุฎุชุงุฑ</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-3">
                        <div class="w-6 h-6 bg-tactical-green rounded-full flex items-center justify-center text-white text-sm font-bold">2</div>
                        <div>
                            <h3 class="font-semibold mb-1">ูุฑู ุงููุณุชูู</h3>
                            <p class="text-muted-foreground text-sm">ุงูููุฒ ุนูู ุนุดูุฑุฉ ุฃููู ูุนุทู ููุงุท ุฅุถุงููุฉ</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-3">
                        <div class="w-6 h-6 bg-tactical-green rounded-full flex items-center justify-center text-white text-sm font-bold">3</div>
                        <div>
                            <h3 class="font-semibold mb-1">ูุฑู ุงูููุงุท</h3>
                            <p class="text-muted-foreground text-sm">ูุฒููุฉ ุนุดูุฑุฉ ุฐุงุช ููุงุท ุฃุนูู ุชุฒูุฏ ุงูููุงูุฃุฉ</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-3">
                        <div class="w-6 h-6 bg-tactical-green rounded-full flex items-center justify-center text-white text-sm font-bold">4</div>
                        <div>
                            <h3 class="font-semibold mb-1">ูุณุชูู ุงูุนุดูุฑุฉ</h3>
                            <p class="text-muted-foreground text-sm">ูุญุฏุฏ ุญุณุจ ุฅุฌูุงูู ุงูููุงุท ุงูููุชุณุจุฉ</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="military-card p-6">
                <h2 class="text-2xl font-bold text-tactical-orange mb-4">โ๏ธ ุฃููุงุน ุงูุญุฑูุจ ูููุงุทูุง</h2>
                <div class="space-y-3" id="warTypesInfo">
                    <div class="text-center text-muted-foreground py-4">
                        <div class="animate-pulse">ุฌุงุฑู ุชุญููู ุฃููุงุน ุงูุญุฑูุจ...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ูุณุชููุงุช ุงูุนุดุงุฆุฑ -->
        <div class="military-card p-6 mb-8">
            <h2 class="text-2xl font-bold text-tactical-gold mb-6">๐ ูุณุชููุงุช ุงูุนุดุงุฆุฑ</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                <div class="text-center p-4 bg-muted rounded-lg">
                    <div class="text-3xl mb-2">๐ฅ</div>
                    <h3 class="font-bold text-foreground">ุงููุณุชูู 1-2</h3>
                    <p class="text-sm text-muted-foreground">0 - 600 ููุทุฉ</p>
                    <div class="text-xs text-tactical-orange">ูุจุชุฏุฆุฉ</div>
                </div>
                
                <div class="text-center p-4 bg-muted rounded-lg">
                    <div class="text-3xl mb-2">๐ฅ</div>
                    <h3 class="font-bold text-foreground">ุงููุณุชูู 3-4</h3>
                    <p class="text-sm text-muted-foreground">600 - 1200 ููุทุฉ</p>
                    <div class="text-xs text-tactical-green">ูุชูุณุทุฉ</div>
                </div>
                
                <div class="text-center p-4 bg-muted rounded-lg">
                    <div class="text-3xl mb-2">๐ฅ</div>
                    <h3 class="font-bold text-foreground">ุงููุณุชูู 5-6</h3>
                    <p class="text-sm text-muted-foreground">1200 - 3000 ููุทุฉ</p>
                    <div class="text-xs text-tactical-blue">ูุชูุฏูุฉ</div>
                </div>
                
                <div class="text-center p-4 bg-muted rounded-lg">
                    <div class="text-3xl mb-2">๐</div>
                    <h3 class="font-bold text-foreground">ุงููุณุชูู 7-8</h3>
                    <p class="text-sm text-muted-foreground">3000 - 6000 ููุทุฉ</p>
                    <div class="text-xs text-tactical-purple">ุฎุจูุฑุฉ</div>
                </div>
                
                <div class="text-center p-4 bg-muted rounded-lg">
                    <div class="text-3xl mb-2">๐</div>
                    <h3 class="font-bold text-foreground">ุงููุณุชูู 9-10</h3>
                    <p class="text-sm text-muted-foreground">6000+ ููุทุฉ</p>
                    <div class="text-xs text-tactical-gold">ุฃุณุทูุฑูุฉ</div>
                </div>
            </div>
        </div>

        <!-- ุงูุชุฑุชูุจ ุงูุญุงูู -->
        <div class="military-card p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-foreground">๐ ุชุฑุชูุจ ุงูุนุดุงุฆุฑ ุงูุญุงูู</h2>
                <button onclick="loadRankings()" class="bg-tactical-green text-white px-4 py-2 rounded-lg hover:bg-tactical-green/80 transition-colors">
                    ุชุญุฏูุซ ุงูุชุฑุชูุจ
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-border">
                            <th class="text-right p-3 text-foreground font-semibold">ุงูุชุฑุชูุจ</th>
                            <th class="text-right p-3 text-foreground font-semibold">ุงูุนุดูุฑุฉ</th>
                            <th class="text-right p-3 text-foreground font-semibold">ุงูููุงุท</th>
                            <th class="text-right p-3 text-foreground font-semibold">ุงููุณุชูู</th>
                            <th class="text-right p-3 text-foreground font-semibold">ุงูุญุฑูุจ</th>
                            <th class="text-right p-3 text-foreground font-semibold">ูุนุฏู ุงูููุฒ</th>
                            <th class="text-right p-3 text-foreground font-semibold">ุงูุณูุณูุฉ</th>
                        </tr>
                    </thead>
                    <tbody id="rankingsTable">
                        <tr>
                            <td colspan="7" class="text-center text-muted-foreground py-8">
                                <div class="flex flex-col items-center gap-2">
                                    <div class="animate-pulse">๐</div>
                                    <p>ุฌุงุฑู ุชุญููู ุงูุชุฑุชูุจ...</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ูุนูููุงุช ุฅุถุงููุฉ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
            <div class="military-card p-6 text-center">
                <div class="text-3xl mb-3">๐ก</div>
                <h3 class="font-bold text-foreground mb-2">ูุตุงุฆุญ ููููุฒ</h3>
                <p class="text-sm text-muted-foreground">ุชุญุฏู ุนุดุงุฆุฑ ุฃููู ููุญุตูู ุนูู ููุงุท ุฅุถุงููุฉ</p>
            </div>
            
            <div class="military-card p-6 text-center">
                <div class="text-3xl mb-3">โก</div>
                <h3 class="font-bold text-foreground mb-2">ุงูุญุฑูุจ ุงูุณุฑูุนุฉ</h3>
                <p class="text-sm text-muted-foreground">ููุงุท ุฃูู ููู ููุช ุฃูู ูุจูุงุก ุงูุฒุฎู</p>
            </div>
            
            <div class="military-card p-6 text-center">
                <div class="text-3xl mb-3">๐</div>
                <h3 class="font-bold text-foreground mb-2">ุงูุจุทููุงุช</h3>
                <p class="text-sm text-muted-foreground">ุฃุนูู ููุงุท ูููุงูุขุช ููุนุดุงุฆุฑ ุงููุชูุฏูุฉ</p>
            </div>
        </div>
    </div>

    <script>
        // ุชุญููู ุงูุจูุงูุงุช ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        document.addEventListener('DOMContentLoaded', function() {
            loadWarTypes();
            loadRankings();
        });

        async function loadWarTypes() {
            try {
                const response = await fetch('http://localhost:8080/war_api.php?action=get_war_data');
                const data = await response.json();
                
                if (data.success && data.war_types) {
                    displayWarTypes(data.war_types);
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุฃููุงุน ุงูุญุฑูุจ:', error);
            }
        }

        function displayWarTypes(warTypes) {
            const container = document.getElementById('warTypesInfo');
            
            container.innerHTML = warTypes.map(type => `
                <div class="flex justify-between items-center p-3 bg-muted rounded-lg">
                    <div>
                        <h4 class="font-semibold text-foreground">${type.name}</h4>
                        <p class="text-xs text-muted-foreground">${type.duration_hours} ุณุงุนุฉ</p>
                    </div>
                    <div class="text-right">
                        <div class="text-tactical-green font-bold">+${type.winner_points}</div>
                        <div class="text-alert-red text-sm">-${type.loser_points}</div>
                    </div>
                </div>
            `).join('');
        }

        async function loadRankings() {
            try {
                const response = await fetch('http://localhost:8080/war_api.php?action=get_rankings');
                const data = await response.json();
                
                if (data.success) {
                    displayRankings(data.rankings);
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุงูุชุฑุชูุจ:', error);
            }
        }

        function displayRankings(rankings) {
            const tbody = document.getElementById('rankingsTable');
            
            if (rankings.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-muted-foreground py-8">
                            ูุง ุชูุฌุฏ ุนุดุงุฆุฑ ูู ุงูุชุฑุชูุจ ุญุงููุงู
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = rankings.slice(0, 20).map((clan, index) => {
                const rankClass = index < 3 ? 'text-tactical-gold' : 'text-foreground';
                const rankIcon = index === 0 ? '๐' : index === 1 ? '๐ฅ' : index === 2 ? '๐ฅ' : '';
                
                return `
                    <tr class="border-b border-border hover:bg-muted/50 transition-colors">
                        <td class="p-3">
                            <span class="font-bold text-lg ${rankClass}">
                                ${rankIcon} #${index + 1}
                            </span>
                        </td>
                        <td class="p-3">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-gradient-to-r from-alert-red to-tactical-orange rounded-lg flex items-center justify-center">
                                    <span class="text-white font-bold text-xs">${clan.tag || 'N/A'}</span>
                                </div>
                                <span class="text-foreground font-medium">${clan.name}</span>
                            </div>
                        </td>
                        <td class="p-3">
                            <span class="font-bold text-tactical-green">${clan.total_points || 0}</span>
                        </td>
                        <td class="p-3">
                            <div class="flex items-center gap-2">
                                <span class="text-foreground">${clan.level || 1}</span>
                                <div class="w-2 h-2 rounded-full ${getLevelColor(clan.level)}"></div>
                            </div>
                        </td>
                        <td class="p-3">
                            <div class="text-sm">
                                <div class="text-muted-foreground">${clan.total_wars || 0} ูุฌููุน</div>
                                <div class="flex gap-2 text-xs">
                                    <span class="text-tactical-green">${clan.wars_won || 0}ู</span>
                                    <span class="text-alert-red">${clan.wars_lost || 0}ุฎ</span>
                                </div>
                            </div>
                        </td>
                        <td class="p-3">
                            <div class="flex items-center gap-2">
                                <span class="text-foreground">${clan.win_rate || 0}%</span>
                                <div class="w-12 h-2 bg-muted rounded-full overflow-hidden">
                                    <div class="h-full bg-tactical-green" style="width: ${clan.win_rate || 0}%"></div>
                                </div>
                            </div>
                        </td>
                        <td class="p-3">
                            <span class="text-foreground font-medium">${clan.current_streak || 0}</span>
                            <div class="text-xs text-muted-foreground">ุฃูุถู: ${clan.best_streak || 0}</div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function getLevelColor(level) {
            if (level >= 9) return 'bg-tactical-gold';
            if (level >= 7) return 'bg-tactical-purple';
            if (level >= 5) return 'bg-tactical-blue';
            if (level >= 3) return 'bg-tactical-green';
            return 'bg-tactical-orange';
        }
    </script>
</BaseLayout>
