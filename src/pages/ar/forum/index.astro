---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import ForumPost from '../../../components/forum/ForumPost.tsx';
import { 
  MessageCircle, 
  Plus, 
  Search, 
  Filter, 
  Pin, 
  Star, 
  TrendingUp, 
  Clock, 
  Eye, 
  Users, 
  Award,
  Flame,
  Target,
  Calendar,
  BookOpen,
  HelpCircle,
  Gamepad2,
  Trophy,
  Zap,
  Compass
} from 'lucide-react';

const title = "Ø§Ù„Ù…Ù†ØªØ¯Ù‰ - Ø²Ø¯ Ø§ØªØ´ Ù„ÙˆÙ";
const description = "Ø§Ù†Ø¶Ù… Ù„Ù…Ø¬ØªÙ…Ø¹ Ù„Ø§Ø¹Ø¨ÙŠ Ø§Ù„Ø¬Ù†Ø±Ø§Ù„Ø§Øª Ø²ÙŠØ±Ùˆ Ø¢ÙˆØ± ÙˆØ´Ø§Ø±Ùƒ ÙÙŠ Ø§Ù„Ù†Ù‚Ø§Ø´Ø§Øª";

// Mock forum data (fallback if API fails)
const forumStats = {
  totalPosts: 0,
  totalTopics: 0,
  totalMembers: 0,
  onlineMembers: 0,
  todaysPosts: 0
};

const categories = [
  {
    id: 1,
    name: "Ø§Ù„Ù†Ù‚Ø§Ø´Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©",
    slug: "general",
    description: "Ù†Ù‚Ø§Ø´Ø§Øª Ø¹Ø§Ù…Ø© Ø­ÙˆÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØ§Ù„Ù…Ø¬ØªÙ…Ø¹",
    color: "#4F9CF9",
    icon: "ğŸ’¬",
    topicsCount: 850,
    postsCount: 4200,
    lastPost: {
      title: "Ø£ÙØ¶Ù„ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ù„Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†",
      author: "Ø¬Ù†Ø±Ø§Ù„ Ø§Ù„ØµØ­Ø±Ø§Ø¡",
      timestamp: "2024-02-17T20:30:00Z"
    }
  },
  {
    id: 2,
    name: "Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª ÙˆØ§Ù„ØªÙƒØªÙŠÙƒØ§Øª",
    slug: "strategies",
    description: "Ø´Ø§Ø±Ùƒ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§ØªÙƒ ÙˆØªØ¹Ù„Ù… Ù…Ù† Ø§Ù„Ø®Ø¨Ø±Ø§Ø¡",
    color: "#06D6A0",
    icon: "ğŸ¯",
    topicsCount: 920,
    postsCount: 5680,
    lastPost: {
      title: "ØªÙƒØªÙŠÙƒØ§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ Ø§Ù„Ù€ GLA",
      author: "Ø³ÙŠØ¯ Ø§Ù„Ø­Ø±Ø¨",
      timestamp: "2024-02-17T19:15:00Z"
    }
  },
  {
    id: 3,
    name: "Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ§Øª",
    slug: "tournaments",
    description: "Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª ÙˆØ§Ù„Ù…Ù†Ø§ÙØ³Ø§Øª",
    color: "#FFD166",
    icon: "ğŸ†",
    topicsCount: 320,
    postsCount: 1890,
    lastPost: {
      title: "Ø¨Ø·ÙˆÙ„Ø© Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø· - Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…ÙØªÙˆØ­",
      author: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª",
      timestamp: "2024-02-17T18:45:00Z"
    }
  },
  {
    id: 4,
    name: "Ø§Ù„Ù…ÙˆØ¯Ø² ÙˆØ§Ù„Ø®Ø±Ø§Ø¦Ø·",
    slug: "mods-maps",
    description: "ØªØ­Ù…ÙŠÙ„ ÙˆÙ…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…ÙˆØ¯Ø² ÙˆØ§Ù„Ø®Ø±Ø§Ø¦Ø·",
    color: "#F72585",
    icon: "ğŸ—ºï¸",
    topicsCount: 450,
    postsCount: 2300,
    lastPost: {
      title: "Ø®Ø±ÙŠØ·Ø© Ø¬Ø¯ÙŠØ¯Ø©: Ø§Ù„ØµØ­Ø±Ø§Ø¡ Ø§Ù„Ù…Ø­Ø±Ù‚Ø©",
      author: "ØµØ§Ù†Ø¹ Ø§Ù„Ø®Ø±Ø§Ø¦Ø·",
      timestamp: "2024-02-17T17:20:00Z"
    }
  },
  {
    id: 5,
    name: "Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ØªÙ‚Ù†ÙŠ",
    slug: "support",
    description: "Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªÙ‚Ù†ÙŠØ©",
    color: "#FF6B6B",
    icon: "ğŸ”§",
    topicsCount: 680,
    postsCount: 3200,
    lastPost: {
      title: "Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯",
      author: "Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯",
      timestamp: "2024-02-17T16:30:00Z"
    }
  }
];

const featuredPosts = [
  {
    id: 1,
    title: "Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ø¹Ø¨ Ù…Ø¹ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø© ÙÙŠ 2024",
    content: "Ø¯Ù„ÙŠÙ„ Ù…ØªÙƒØ§Ù…Ù„ ÙŠØºØ·ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø© Ù…Ø¹ Ø£Ø­Ø¯Ø« Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙˆØ§Ù„ØªÙƒØªÙŠÙƒØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©...",
    excerpt: "Ø¯Ù„ÙŠÙ„ Ù…ØªÙƒØ§Ù…Ù„ ÙŠØºØ·ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø© Ù…Ø¹ Ø£Ø­Ø¯Ø« Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙˆØ§Ù„ØªÙƒØªÙŠÙƒØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„ØªÙ†Ø§ÙØ³ÙŠØ©",
    author: {
      id: 1,
      username: "usa_master",
      displayName: "Ø³ÙŠØ¯ Ø£Ù…Ø±ÙŠÙƒØ§",
      avatar: "/avatars/usa_master.png",
      badge: "expert",
      level: 45,
      reputation: 2850,
      verified: true,
      isOnline: true,
      postCount: 1250,
      joinedAt: "2023-01-15T00:00:00Z"
    },
    category: {
      id: 2,
      name: "Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª ÙˆØ§Ù„ØªÙƒØªÙŠÙƒØ§Øª",
      slug: "strategies",
      color: "#06D6A0"
    },
    tags: [
      { id: 1, name: "Ø£Ù…Ø±ÙŠÙƒØ§", color: "#4F9CF9" },
      { id: 2, name: "Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©", color: "#06D6A0" },
      { id: 3, name: "Ù…ØªÙ‚Ø¯Ù…", color: "#FFD166" }
    ],
    createdAt: "2024-02-17T14:30:00Z",
    updatedAt: "2024-02-17T14:30:00Z",
    stats: {
      views: 3420,
      likes: 189,
      dislikes: 12,
      comments: 67,
      shares: 34,
      bookmarks: 156
    },
    status: "published",
    type: "guide",
    priority: "featured",
    difficulty: "advanced",
    gameRelated: {
      faction: "usa",
      gameMode: "1v1"
    },
    hasAnswered: false,
    isLiked: false,
    isBookmarked: false,
    permissions: {
      canEdit: false,
      canDelete: false,
      canPin: false,
      canLock: false
    }
  },
  {
    id: 2,
    title: "Ø¨Ø·ÙˆÙ„Ø© Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø· Ø§Ù„ÙƒØ¨Ø±Ù‰ - Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„Ø¬ÙˆØ§Ø¦Ø²",
    content: "Ø¥Ø¹Ù„Ø§Ù† Ø±Ø³Ù…ÙŠ Ø¹Ù† Ø¨Ø·ÙˆÙ„Ø© Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø· Ø§Ù„ÙƒØ¨Ø±Ù‰ 2024 Ù…Ø¹ Ø¬ÙˆØ§Ø¦Ø² ØªØµÙ„ Ø¥Ù„Ù‰ 5000 Ø¯ÙˆÙ„Ø§Ø±...",
    excerpt: "Ø¥Ø¹Ù„Ø§Ù† Ø±Ø³Ù…ÙŠ Ø¹Ù† Ø¨Ø·ÙˆÙ„Ø© Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø· Ø§Ù„ÙƒØ¨Ø±Ù‰ 2024 Ù…Ø¹ Ø¬ÙˆØ§Ø¦Ø² ØªØµÙ„ Ø¥Ù„Ù‰ 5000 Ø¯ÙˆÙ„Ø§Ø± ÙˆØ§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…ÙØªÙˆØ­ Ø§Ù„Ø¢Ù†",
    author: {
      id: 2,
      username: "tournament_admin",
      displayName: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª",
      avatar: "/avatars/tournament_admin.png",
      badge: "moderator",
      level: 50,
      reputation: 5000,
      verified: true,
      isOnline: false,
      postCount: 890,
      joinedAt: "2023-01-01T00:00:00Z"
    },
    category: {
      id: 3,
      name: "Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ§Øª",
      slug: "tournaments",
      color: "#FFD166"
    },
    tags: [
      { id: 4, name: "Ø¨Ø·ÙˆÙ„Ø©", color: "#FFD166" },
      { id: 5, name: "Ø¬ÙˆØ§Ø¦Ø²", color: "#F72585" },
      { id: 6, name: "ØªØ³Ø¬ÙŠÙ„", color: "#06D6A0" }
    ],
    createdAt: "2024-02-17T12:00:00Z",
    updatedAt: "2024-02-17T12:00:00Z",
    stats: {
      views: 5680,
      likes: 267,
      dislikes: 8,
      comments: 134,
      shares: 89,
      bookmarks: 234
    },
    status: "published",
    type: "news",
    priority: "pinned",
    hasAnswered: false,
    isLiked: true,
    isBookmarked: true,
    permissions: {
      canEdit: false,
      canDelete: false,
      canPin: false,
      canLock: false
    }
  }
];

const recentPosts = [
  {
    id: 3,
    title: "ÙƒÙŠÙ Ø£ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ø·Ø§Ø¦Ø±Ø§Øª Ø§Ù„Ù…Ø¨ÙƒØ±Ø©ØŸ",
    content: "Ø£ÙˆØ§Ø¬Ù‡ ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ø¬ÙˆÙŠØ© Ø§Ù„Ù…Ø¨ÙƒØ±Ø©ØŒ Ø®Ø§ØµØ© Ù…Ø¹ Ø£Ù…Ø±ÙŠÙƒØ§...",
    excerpt: "Ø£ÙˆØ§Ø¬Ù‡ ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ø¬ÙˆÙŠØ© Ø§Ù„Ù…Ø¨ÙƒØ±Ø©ØŒ Ø®Ø§ØµØ© Ù…Ø¹ Ø£Ù…Ø±ÙŠÙƒØ§. Ù…Ø§ Ù‡ÙŠ Ø£ÙØ¶Ù„ Ø§Ù„Ø·Ø±Ù‚ Ù„Ù„Ø¯ÙØ§Ø¹ØŸ",
    author: {
      id: 3,
      username: "newbie_general",
      displayName: "Ø¬Ù†Ø±Ø§Ù„ Ù…Ø¨ØªØ¯Ø¦",
      avatar: "/avatars/newbie_general.png",
      level: 8,
      reputation: 120,
      verified: false,
      isOnline: true,
      postCount: 45,
      joinedAt: "2024-01-20T00:00:00Z"
    },
    category: {
      id: 2,
      name: "Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª ÙˆØ§Ù„ØªÙƒØªÙŠÙƒØ§Øª",
      slug: "strategies",
      color: "#06D6A0"
    },
    tags: [
      { id: 7, name: "Ù…Ø¨ØªØ¯Ø¦", color: "#06D6A0" },
      { id: 8, name: "Ø¯ÙØ§Ø¹", color: "#4F9CF9" },
      { id: 9, name: "Ø·ÙŠØ±Ø§Ù†", color: "#FFD166" }
    ],
    createdAt: "2024-02-17T20:15:00Z",
    updatedAt: "2024-02-17T20:15:00Z",
    stats: {
      views: 89,
      likes: 12,
      dislikes: 1,
      comments: 8,
      shares: 2,
      bookmarks: 5
    },
    status: "published",
    type: "question",
    priority: "normal",
    difficulty: "beginner",
    gameRelated: {
      faction: "usa",
      gameMode: "1v1"
    },
    hasAnswered: false,
    isLiked: false,
    isBookmarked: false,
    permissions: {
      canEdit: false,
      canDelete: false,
      canPin: false,
      canLock: false
    }
  },
  {
    id: 4,
    title: "Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯ - Ø­Ù„ÙˆÙ„ Ù…Ù‚ØªØ±Ø­Ø©",
    content: "Ø¬Ù…Ø¹Øª Ù‡Ù†Ø§ Ø£Ù‡Ù… Ø§Ù„Ø­Ù„ÙˆÙ„ Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯...",
    excerpt: "Ø¬Ù…Ø¹Øª Ù‡Ù†Ø§ Ø£Ù‡Ù… Ø§Ù„Ø­Ù„ÙˆÙ„ Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªØ¬Ø±Ø¨ØªÙŠ Ø§Ù„Ø·ÙˆÙŠÙ„Ø©",
    author: {
      id: 4,
      username: "tech_support",
      displayName: "Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ØªÙ‚Ù†ÙŠ",
      avatar: "/avatars/tech_support.png",
      badge: "expert",
      level: 38,
      reputation: 1890,
      verified: true,
      isOnline: false,
      postCount: 567,
      joinedAt: "2023-03-10T00:00:00Z"
    },
    category: {
      id: 5,
      name: "Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ØªÙ‚Ù†ÙŠ",
      slug: "support",
      color: "#FF6B6B"
    },
    tags: [
      { id: 10, name: "Ø§ØªØµØ§Ù„", color: "#FF6B6B" },
      { id: 11, name: "Ø­Ù„ÙˆÙ„", color: "#06D6A0" },
      { id: 12, name: "Ù…ØªØ¹Ø¯Ø¯", color: "#4F9CF9" }
    ],
    createdAt: "2024-02-17T19:45:00Z",
    updatedAt: "2024-02-17T19:45:00Z",
    stats: {
      views: 234,
      likes: 45,
      dislikes: 3,
      comments: 23,
      shares: 12,
      bookmarks: 34
    },
    status: "published",
    type: "guide",
    priority: "normal",
    difficulty: "intermediate",
    hasAnswered: true,
    bestAnswer: {
      commentId: 15,
      authorId: 4
    },
    isLiked: false,
    isBookmarked: false,
    permissions: {
      canEdit: false,
      canDelete: false,
      canPin: false,
      canLock: false
    }
  }
];

const quickActions = [
  { id: "new-post", name: "Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯", icon: Plus, color: "bg-tactical-green" },
  { id: "ask-question", name: "Ø§Ø³Ø£Ù„ Ø³Ø¤Ø§Ù„", icon: HelpCircle, color: "bg-command-blue" },
  { id: "share-strategy", name: "Ø´Ø§Ø±Ùƒ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©", icon: Target, color: "bg-victory-gold" },
  { id: "upload-replay", name: "Ø§Ø±ÙØ¹ Ø±ÙŠØ¨Ù„Ø§ÙŠ", icon: Gamepad2, color: "bg-purple-500" }
];

const topContributors = [
  {
    id: 1,
    username: "master_strategist",
    displayName: "Ø³ÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©",
    avatar: "/avatars/master_strategist.png",
    badge: "expert",
    postsThisWeek: 23,
    reputation: 4500,
    verified: true
  },
  {
    id: 2,
    username: "tournament_king",
    displayName: "Ù…Ù„Ùƒ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª",
    avatar: "/avatars/tournament_king.png",
    badge: "vip",
    postsThisWeek: 18,
    reputation: 3890,
    verified: true
  },
  {
    id: 3,
    username: "helpful_guide",
    displayName: "Ø§Ù„Ù…Ø±Ø´Ø¯ Ø§Ù„Ù…ÙÙŠØ¯",
    avatar: "/avatars/helpful_guide.png",
    badge: "veteran",
    postsThisWeek: 15,
    reputation: 3200,
    verified: false
  }
];
---

<BaseLayout title={title} description={description}>
  <div class="container-custom py-8">
    <!-- Header -->
    <div class="flex items-center justify-between mb-8">
      <div>
        <h1 class="text-3xl font-bold text-foreground mb-2 flex items-center space-x-3 rtl:space-x-reverse">
          <MessageCircle size={32} class="text-command-blue" />
          <span>Ø§Ù„Ù…Ù†ØªØ¯Ù‰</span>
        </h1>
        <p class="text-muted-foreground">Ø§Ù†Ø¶Ù… Ù„Ù…Ø¬ØªÙ…Ø¹ Ù„Ø§Ø¹Ø¨ÙŠ Ø§Ù„Ø¬Ù†Ø±Ø§Ù„Ø§Øª Ø²ÙŠØ±Ùˆ Ø¢ÙˆØ± ÙˆØ´Ø§Ø±Ùƒ ÙÙŠ Ø§Ù„Ù†Ù‚Ø§Ø´Ø§Øª</p>
      </div>
      <a href="/ar/forum/new" id="new-post-btn" class="btn btn-primary flex items-center space-x-2 rtl:space-x-reverse">
        <Plus size={20} />
        <span>Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯</span>
      </a>
    </div>

    <!-- Forum Statistics -->
    <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
      <div class="military-card p-4 text-center">
        <div class="text-2xl font-bold text-command-blue mb-1" data-stat="total-posts">{forumStats.totalPosts.toLocaleString()}</div>
        <div class="text-sm text-muted-foreground">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</div>
      </div>
      <div class="military-card p-4 text-center">
        <div class="text-2xl font-bold text-tactical-green mb-1" data-stat="total-topics">{forumStats.totalTopics.toLocaleString()}</div>
        <div class="text-sm text-muted-foreground">Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª</div>
      </div>
      <div class="military-card p-4 text-center">
        <div class="text-2xl font-bold text-victory-gold mb-1" data-stat="total-members">{forumStats.totalMembers.toLocaleString()}</div>
        <div class="text-sm text-muted-foreground">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</div>
      </div>
      <div class="military-card p-4 text-center">
        <div class="text-2xl font-bold text-orange-500 mb-1" data-stat="online-members">{forumStats.onlineMembers}</div>
        <div class="text-sm text-muted-foreground">Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†</div>
      </div>
      <div class="military-card p-4 text-center">
        <div class="text-2xl font-bold text-purple-500 mb-1" data-stat="todays-posts">{forumStats.todaysPosts}</div>
        <div class="text-sm text-muted-foreground">Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
      </div>
    </div>

    <!-- Search and Filters -->
    <div class="military-card p-4 mb-8">
      <div class="flex flex-col lg:flex-row gap-4">
        <div class="flex-1 relative">
          <Search class="absolute left-3 rtl:right-3 rtl:left-auto top-1/2 transform -translate-y-1/2 text-muted-foreground" size={20} />
          <input
            type="text"
            id="search-input"
            placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¯Ù‰..."
            class="w-full pl-10 rtl:pr-10 rtl:pl-3 pr-3 py-2 bg-input border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-ring"
          />
        </div>
        
        <div class="flex items-center gap-2">
          <Filter size={20} class="text-muted-foreground" />
          
          <select class="bg-input border border-border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring">
            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
            {categories.map(cat => (
              <option value={cat.slug}>{cat.name}</option>
            ))}
          </select>
          
          <select class="bg-input border border-border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring">
            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
            <option value="discussion">Ù…Ù†Ø§Ù‚Ø´Ø©</option>
            <option value="question">Ø³Ø¤Ø§Ù„</option>
            <option value="guide">Ø¯Ù„ÙŠÙ„</option>
            <option value="news">Ø£Ø®Ø¨Ø§Ø±</option>
            <option value="poll">Ø§Ø³ØªØ·Ù„Ø§Ø¹</option>
          </select>
          
          <select class="bg-input border border-border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-ring">
            <option value="recent">Ø§Ù„Ø£Ø­Ø¯Ø«</option>
            <option value="popular">Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ø¹Ø¨ÙŠØ©</option>
            <option value="trending">Ø§Ù„Ø£ÙƒØ«Ø± ØªÙØ§Ø¹Ù„Ø§Ù‹</option>
            <option value="answered">ØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§</option>
            <option value="unanswered">Ø¨Ø¯ÙˆÙ† Ø±Ø¯</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
      {quickActions.map((action) => (
        <a 
          key={action.id}
          href={`/ar/forum/new?type=${action.id}`} 
          class="military-card p-4 text-center hover:shadow-lg transition-all duration-300 group"
        >
          <div class={`w-12 h-12 ${action.color} rounded-lg flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform`}>
            <action.icon size={24} class="text-white" />
          </div>
          <div class="font-medium text-foreground text-sm">{action.name}</div>
        </a>
      ))}
    </div>

    <!-- Main Content -->
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
      <!-- Forum Content -->
      <div class="lg:col-span-3 space-y-8">
        <!-- Categories Overview -->
        <section>
          <h2 class="text-2xl font-bold text-foreground mb-6 flex items-center space-x-2 rtl:space-x-reverse">
            <Compass size={24} class="text-primary" />
            <span>ÙØ¦Ø§Øª Ø§Ù„Ù…Ù†ØªØ¯Ù‰</span>
          </h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8" id="categories-container">
            {categories.map(category => (
              <a 
                key={category.id}
                href={`/ar/forum/category/${category.slug}`}
                class="military-card p-6 hover:shadow-lg transition-all duration-300 group"
              >
                <div class="flex items-start space-x-4 rtl:space-x-reverse">
                  <div 
                    class="w-12 h-12 rounded-lg flex items-center justify-center text-2xl group-hover:scale-110 transition-transform"
                    style={`background-color: ${category.color}20`}
                  >
                    {category.icon}
                  </div>
                  
                  <div class="flex-1 min-w-0">
                    <h3 class="font-semibold text-foreground group-hover:text-primary transition-colors mb-1">
                      {category.name}
                    </h3>
                    <p class="text-sm text-muted-foreground mb-3 line-clamp-2">
                      {category.description}
                    </p>
                    
                    <div class="flex items-center justify-between text-xs text-muted-foreground">
                      <div class="flex items-center space-x-4 rtl:space-x-reverse">
                        <span>{category.topicsCount} Ù…ÙˆØ¶ÙˆØ¹</span>
                        <span>{category.postsCount} Ù…Ù†Ø´ÙˆØ±</span>
                      </div>
                      
                      {category.lastPost && (
                        <div class="text-right rtl:text-left">
                          <div class="font-medium text-foreground text-sm truncate max-w-24">
                            {category.lastPost.title}
                          </div>
                          <div class="text-xs">
                            Ø¨ÙˆØ§Ø³Ø·Ø© {category.lastPost.author}
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              </a>
            ))}
          </div>
        </section>

        <!-- Featured Posts -->
        <section>
          <h2 class="text-2xl font-bold text-foreground mb-6 flex items-center space-x-2 rtl:space-x-reverse">
            <Star size={24} class="text-victory-gold" />
            <span>Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©</span>
          </h2>
          
          <div class="space-y-6" id="featured-posts-container">
            {featuredPosts.map(post => (
              <ForumPost 
                key={post.id}
                post={post}
                onLike={(id) => console.log('Like post:', id)}
                onComment={(id) => window.location.href = `/ar/forum/post/${id}#comments`}
                onShare={(id) => console.log('Share post:', id)}
                onBookmark={(id) => console.log('Bookmark post:', id)}
                onReport={(id) => console.log('Report post:', id)}
                onView={(id) => window.location.href = `/ar/forum/post/${id}`}
                showActions={true}
                isCompact={false}
                currentUserId={1}
                client:load
              />
            ))}
          </div>
        </section>

        <!-- Recent Posts -->
        <section>
          <h2 class="text-2xl font-bold text-foreground mb-6 flex items-center space-x-2 rtl:space-x-reverse">
            <Clock size={24} class="text-tactical-green" />
            <span>Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</span>
          </h2>
          
          <div class="space-y-4" id="recent-posts-container">
            {recentPosts.map(post => (
              <ForumPost 
                key={post.id}
                post={post}
                onLike={(id) => console.log('Like post:', id)}
                onComment={(id) => window.location.href = `/ar/forum/post/${id}#comments`}
                onShare={(id) => console.log('Share post:', id)}
                onBookmark={(id) => console.log('Bookmark post:', id)}
                onReport={(id) => console.log('Report post:', id)}
                onView={(id) => window.location.href = `/ar/forum/post/${id}`}
                showActions={true}
                isCompact={true}
                currentUserId={1}
                client:load
              />
            ))}
          </div>
          
          <div class="text-center mt-6">
            <a href="/ar/forum/recent" class="btn btn-outline">
              Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
            </a>
          </div>
        </section>
      </div>

      <!-- Sidebar -->
      <div class="lg:col-span-1 space-y-6">
        <!-- Top Contributors -->
        <div class="military-card p-6">
          <h3 class="text-lg font-bold text-foreground mb-4 flex items-center space-x-2 rtl:space-x-reverse">
            <Award size={20} class="text-victory-gold" />
            <span>Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…ÙŠÙ†</span>
          </h3>
          
          <div class="space-y-4">
            {topContributors.map((contributor, index) => (
              <div key={contributor.id} class="flex items-center space-x-3 rtl:space-x-reverse">
                <div class="relative">
                  <img 
                    src={contributor.avatar} 
                    alt={contributor.displayName}
                    class="w-10 h-10 rounded-full"
                  />
                  <div class={`absolute -top-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold text-white ${
                    index === 0 ? 'bg-victory-gold' : 
                    index === 1 ? 'bg-neutral-silver' : 
                    'bg-amber-600'
                  }`}>
                    {index + 1}
                  </div>
                </div>
                
                <div class="flex-1 min-w-0">
                  <div class="flex items-center space-x-1 rtl:space-x-reverse">
                    <span class="font-medium text-foreground text-sm truncate">
                      {contributor.displayName}
                    </span>
                    {contributor.verified && (
                      <Star size={12} class="text-tactical-green" />
                    )}
                  </div>
                  <div class="text-xs text-muted-foreground">
                    {contributor.postsThisWeek} Ù…Ù†Ø´ÙˆØ± â€¢ {contributor.reputation} Ù†Ù‚Ø·Ø©
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>

        <!-- Trending Topics -->
        <div class="military-card p-6">
          <h3 class="text-lg font-bold text-foreground mb-4 flex items-center space-x-2 rtl:space-x-reverse">
            <TrendingUp size={20} class="text-orange-500" />
            <span>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø§Ù„Ø±Ø§Ø¦Ø¬Ø©</span>
          </h3>
          
          <div class="space-y-3">
            <div class="flex items-center space-x-2 rtl:space-x-reverse">
              <Flame size={16} class="text-orange-500" />
              <a href="/ar/forum/topic/hot" class="text-sm text-foreground hover:text-primary transition-colors">
                Ø£ÙØ¶Ù„ ØªØ­Ø¯ÙŠØ« Ù„Ù„Ø¹Ø¨Ø© Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…
              </a>
            </div>
            <div class="flex items-center space-x-2 rtl:space-x-reverse">
              <Zap size={16} class="text-victory-gold" />
              <a href="/ar/forum/topic/trending" class="text-sm text-foreground hover:text-primary transition-colors">
                Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØµÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
              </a>
            </div>
            <div class="flex items-center space-x-2 rtl:space-x-reverse">
              <Trophy size={16} class="text-tactical-green" />
              <a href="/ar/forum/topic/tournament" class="text-sm text-foreground hover:text-primary transition-colors">
                Ø¨Ø·ÙˆÙ„Ø© Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø· 2024
              </a>
            </div>
            <div class="flex items-center space-x-2 rtl:space-x-reverse">
              <Target size={16} class="text-command-blue" />
              <a href="/ar/forum/topic/strategy" class="text-sm text-foreground hover:text-primary transition-colors">
                ØªÙƒØªÙŠÙƒØ§Øª Ø§Ù„Ø¯ÙØ§Ø¹ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
              </a>
            </div>
          </div>
        </div>

        <!-- Forum Rules -->
        <div class="military-card p-6">
          <h3 class="text-lg font-bold text-foreground mb-4 flex items-center space-x-2 rtl:space-x-reverse">
            <BookOpen size={20} class="text-command-blue" />
            <span>Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ù…Ù†ØªØ¯Ù‰</span>
          </h3>
          
          <div class="space-y-2 text-sm text-muted-foreground">
            <div class="flex items-start space-x-2 rtl:space-x-reverse">
              <div class="w-1.5 h-1.5 bg-tactical-green rounded-full flex-shrink-0 mt-2"></div>
              <span>Ø§Ø­ØªØ±Ù… Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†</span>
            </div>
            <div class="flex items-start space-x-2 rtl:space-x-reverse">
              <div class="w-1.5 h-1.5 bg-tactical-green rounded-full flex-shrink-0 mt-2"></div>
              <span>Ù„Ø§ ØªÙ†Ø´Ø± Ù…Ø­ØªÙˆÙ‰ Ù…Ø³ÙŠØ¡</span>
            </div>
            <div class="flex items-start space-x-2 rtl:space-x-reverse">
              <div class="w-1.5 h-1.5 bg-tactical-green rounded-full flex-shrink-0 mt-2"></div>
              <span>Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</span>
            </div>
            <div class="flex items-start space-x-2 rtl:space-x-reverse">
              <div class="w-1.5 h-1.5 bg-tactical-green rounded-full flex-shrink-0 mt-2"></div>
              <span>Ù„Ø§ ØªÙ†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ØºÙŠØ± Ù…Ø±Ø®ØµØ©</span>
            </div>
            <div class="flex items-start space-x-2 rtl:space-x-reverse">
              <div class="w-1.5 h-1.5 bg-tactical-green rounded-full flex-shrink-0 mt-2"></div>
              <span>ØªØ£ÙƒØ¯ Ù…Ù† Ø¯Ù‚Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</span>
            </div>
          </div>
          
          <div class="mt-4">
            <a href="/ar/forum/rules" class="text-sm text-primary hover:underline">
              Ø§Ù‚Ø±Ø£ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„ÙƒØ§Ù…Ù„Ø©
            </a>
          </div>
        </div>

        <!-- Online Members -->
        <div class="military-card p-6">
          <h3 class="text-lg font-bold text-foreground mb-4 flex items-center space-x-2 rtl:space-x-reverse">
            <Users size={20} class="text-tactical-green" />
            <span>Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù† ({forumStats.onlineMembers})</span>
          </h3>
          
          <div class="flex flex-wrap gap-2">
            <div class="flex items-center space-x-1 rtl:space-x-reverse">
              <div class="w-2 h-2 bg-tactical-green rounded-full"></div>
              <span class="text-xs text-muted-foreground">Ø³ÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©</span>
            </div>
            <div class="flex items-center space-x-1 rtl:space-x-reverse">
              <div class="w-2 h-2 bg-tactical-green rounded-full"></div>
              <span class="text-xs text-muted-foreground">Ø¬Ù†Ø±Ø§Ù„ Ø§Ù„ØµØ­Ø±Ø§Ø¡</span>
            </div>
            <div class="flex items-center space-x-1 rtl:space-x-reverse">
              <div class="w-2 h-2 bg-tactical-green rounded-full"></div>
              <span class="text-xs text-muted-foreground">Ù…Ù„Ùƒ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª</span>
            </div>
            <span class="text-xs text-muted-foreground">Ùˆ {forumStats.onlineMembers - 3} Ø¢Ø®Ø±ÙŠÙ†</span>
          </div>
        </div>

        <!-- Latest Activity -->
        <div class="military-card p-6">
          <h3 class="text-lg font-bold text-foreground mb-4 flex items-center space-x-2 rtl:space-x-reverse">
            <Clock size={20} class="text-orange-500" />
            <span>Ø¢Ø®Ø± Ø§Ù„Ø£Ù†Ø´Ø·Ø©</span>
          </h3>
          
          <div class="space-y-3 text-sm">
            <div class="flex items-center space-x-2 rtl:space-x-reverse">
              <div class="w-2 h-2 bg-tactical-green rounded-full"></div>
              <span class="text-muted-foreground">
                <span class="font-medium text-foreground">Ø£Ø­Ù…Ø¯</span> Ø±Ø¯ Ø¹Ù„Ù‰ 
                <span class="text-primary">Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„Ø¯ÙØ§Ø¹</span>
              </span>
            </div>
            <div class="flex items-center space-x-2 rtl:space-x-reverse">
              <div class="w-2 h-2 bg-command-blue rounded-full"></div>
              <span class="text-muted-foreground">
                <span class="font-medium text-foreground">Ø³Ø§Ø±Ø©</span> Ø£Ù†Ø´Ø£Øª Ù…ÙˆØ¶ÙˆØ¹ 
                <span class="text-primary">Ù…ÙˆØ¯Ø² Ø¬Ø¯ÙŠØ¯Ø©</span>
              </span>
            </div>
            <div class="flex items-center space-x-2 rtl:space-x-reverse">
              <div class="w-2 h-2 bg-victory-gold rounded-full"></div>
              <span class="text-muted-foreground">
                <span class="font-medium text-foreground">Ù…Ø­Ù…Ø¯</span> Ø£Ø¹Ø¬Ø¨ Ø¨Ù€ 
                <span class="text-primary">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†</span>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .category-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }
  
  .post-title:hover {
    text-decoration: underline;
  }
  
  /* Loading animation */
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }
  
  .loading {
    animation: pulse 2s infinite;
  }
</style>

<!-- JavaScript for API Integration -->
<script>
  // Forum data and state
  let currentPage = 1;
  let loading = false;
  let categories = [];
  let posts = [];

  // API functions
  async function fetchForumStats() {
    try {
      const response = await fetch('/backend/public/forum_api.php?action=get_stats');
      const data = await response.json();
      
      if (data.success) {
        updateStats(data.stats);
      } else {
        console.error('Failed to fetch stats:', data.error);
      }
    } catch (error) {
      console.error('Error fetching forum stats:', error);
    }
  }

  async function fetchCategories() {
    try {
      const response = await fetch('/backend/public/forum_api.php?action=get_categories');
      const data = await response.json();
      
      if (data.success) {
        categories = data.categories;
        renderCategories(categories);
      } else {
        console.error('Failed to fetch categories:', data.error);
      }
    } catch (error) {
      console.error('Error fetching categories:', error);
    }
  }

  async function fetchPosts(page = 1, categoryId = null, sort = 'latest', search = '') {
    if (loading) return;
    loading = true;
    
    try {
      const params = new URLSearchParams({
        action: 'get_posts',
        page: page.toString(),
        limit: '10',
        sort: sort
      });
      
      if (categoryId) params.append('category_id', categoryId);
      if (search) params.append('search', search);
      
      const response = await fetch(`/backend/public/forum_api.php?${params}`);
      const data = await response.json();
      
      if (data.success) {
        if (page === 1) {
          posts = data.posts;
        } else {
          posts = [...posts, ...data.posts];
        }
        
        if (posts.length === 0 && page === 1) {
          renderEmptyState();
        } else {
          renderRecentPosts(posts, page === 1);
          renderFeaturedPosts(posts.filter(post => post.is_featured == 1));
        }
      } else {
        console.error('Failed to fetch posts:', data.error);
      }
    } catch (error) {
      console.error('Error fetching posts:', error);
    } finally {
      loading = false;
    }
  }

  // Interactive functions for posts
  async function likePost(postId) {
    try {
      const token = localStorage.getItem('zh_love_token');
      const response = await fetch('http://localhost:8080/forum_api.php?action=like_post', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({ post_id: postId })
      });
      
      const data = await response.json();
      if (data.success) {
        // Update like count in UI
        updatePostLikeCount(postId, data.like_count, data.user_liked);
        showNotification('ØªÙ… Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø¨Ø§Ù„Ù…Ù†Ø´ÙˆØ±', 'success');
      } else {
        showNotification(data.error || 'ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨', 'error');
      }
    } catch (error) {
      console.error('Error liking post:', error);
      showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©', 'error');
    }
  }

  async function commentOnPost(postId, content) {
    try {
      const token = localStorage.getItem('zh_love_token');
      const response = await fetch('http://localhost:8080/forum_api.php?action=create_comment', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({ 
          post_id: postId,
          content: content
        })
      });
      
      const data = await response.json();
      if (data.success) {
        // Add comment to UI
        addCommentToPost(postId, data.comment);
        showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        return true;
      } else {
        showNotification(data.error || 'ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚', 'error');
        return false;
      }
    } catch (error) {
      console.error('Error commenting on post:', error);
      showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©', 'error');
      return false;
    }
  }

  async function fetchComments(postId) {
    try {
      const response = await fetch(`http://localhost:8080/forum_api.php?action=get_comments&post_id=${postId}`);
      const data = await response.json();
      
      if (data.success) {
        return data.comments;
      } else {
        console.error('Failed to fetch comments:', data.error);
        return [];
      }
    } catch (error) {
      console.error('Error fetching comments:', error);
      return [];
    }
  }

  function sharePost(postId) {
    const url = `${window.location.origin}/ar/forum/post/${postId}`;
    
    if (navigator.share) {
      navigator.share({
        title: 'Ù…Ù†Ø´ÙˆØ± Ù…Ù† Ù…Ù†ØªØ¯Ù‰ Ø²Ø¯ Ø§ØªØ´ Ù„ÙˆÙ',
        url: url
      });
    } else {
      navigator.clipboard.writeText(url).then(() => {
        showNotification('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†Ø´ÙˆØ±', 'success');
      });
    }
  }

  // Render functions
  function updateStats(stats) {
    // Update forum stats in the page
    const totalPostsElement = document.querySelector('[data-stat="total-posts"]');
    const totalTopicsElement = document.querySelector('[data-stat="total-topics"]');
    const totalMembersElement = document.querySelector('[data-stat="total-members"]');
    const todaysPostsElement = document.querySelector('[data-stat="todays-posts"]');
    
    if (totalPostsElement) totalPostsElement.textContent = stats.total_posts || '0';
    if (totalTopicsElement) totalTopicsElement.textContent = stats.total_posts || '0';
    if (totalMembersElement) totalMembersElement.textContent = stats.total_members || '0';
    if (todaysPostsElement) todaysPostsElement.textContent = stats.todays_posts || '0';
  }

  function renderCategories(categories) {
    const categoriesContainer = document.querySelector('#categories-container');
    if (!categoriesContainer) return;
    
    const categoriesHtml = categories.map(category => `
      <div class="bg-card border border-border rounded-lg p-6 hover:border-tactical-green/50 transition-colors cursor-pointer category-card" 
           data-category-id="${category.id}">
        <div class="flex items-start justify-between">
          <div class="flex-1">
            <div class="flex items-center gap-3 mb-2">
              <span class="text-2xl">${category.icon || 'ğŸ“'}</span>
              <h3 class="text-lg font-semibold text-foreground">${category.name}</h3>
            </div>
            <p class="text-muted-foreground text-sm mb-4">${category.description || ''}</p>
            
            <div class="flex items-center gap-4 text-sm text-muted-foreground">
              <span class="flex items-center gap-1">
                <span class="w-4 h-4">ğŸ’¬</span>
                ${category.topic_count || category.post_count || 0} Ù…ÙˆØ¶ÙˆØ¹
              </span>
              <span class="flex items-center gap-1">
                <span class="w-4 h-4">ğŸ’­</span>
                ${category.comment_count || category.total_comments || 0} ØªØ¹Ù„ÙŠÙ‚
              </span>
            </div>
          </div>
          
          <div class="text-right">
            <div class="w-3 h-3 rounded-full" style="background-color: ${category.color || '#4F9CF9'}"></div>
          </div>
        </div>
      </div>
    `).join('');
    
    categoriesContainer.innerHTML = categoriesHtml;
    
    // Add click handlers
    document.querySelectorAll('.category-card').forEach(card => {
      card.addEventListener('click', () => {
        const categoryId = card.getAttribute('data-category-id');
        filterByCategory(categoryId);
      });
    });
  }

  function renderRecentPosts(posts, replace = true) {
    const recentPostsContainer = document.querySelector('#recent-posts-container');
    if (!recentPostsContainer) return;
    
    const postsHtml = posts.map(post => `
      <article class="bg-card border border-border rounded-lg p-6 hover:border-tactical-green/30 transition-colors" data-post-id="${post.id}">
        <div class="flex items-start justify-between mb-4">
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-2">
              ${post.is_pinned == 1 ? '<span class="w-4 h-4 text-yellow-500">ğŸ“Œ</span>' : ''}
              ${post.is_featured == 1 ? '<span class="w-4 h-4 text-yellow-500">â­</span>' : ''}
              <span class="px-2 py-1 text-xs rounded-full" style="background-color: ${post.category_color || '#4F9CF9'}20; color: ${post.category_color || '#4F9CF9'}">
                ${post.category_name || 'Ø¹Ø§Ù…'}
              </span>
            </div>
            
            <h3 class="text-lg font-semibold text-foreground mb-2 cursor-pointer hover:text-tactical-green transition-colors post-title" 
                data-post-id="${post.id}">
              ${post.title}
            </h3>
            
            <p class="text-muted-foreground text-sm mb-4 line-clamp-2">
              ${post.content.substring(0, 200)}...
            </p>
            
            ${post.images ? `
              <div class="flex gap-2 mb-4 flex-wrap">
                ${JSON.parse(post.images).slice(0, 3).map(img => `
                  <img src="/uploads/forum/${img}" alt="ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù…Ù†Ø´ÙˆØ±" 
                       class="w-16 h-16 object-cover rounded-md border border-border">
                `).join('')}
                ${JSON.parse(post.images).length > 3 ? `
                  <div class="w-16 h-16 bg-gray-100 rounded-md border border-border flex items-center justify-center text-xs text-gray-600">
                    +${JSON.parse(post.images).length - 3}
                  </div>
                ` : ''}
              </div>
            ` : ''}
            
            <div class="flex items-center gap-4 text-sm text-muted-foreground mb-4">
              <span class="flex items-center gap-1">
                <span class="w-4 h-4">ğŸ‘¤</span>
                ${post.author_username || 'Ù…Ø¬Ù‡ÙˆÙ„'}
              </span>
              <span class="flex items-center gap-1">
                <span class="w-4 h-4">ğŸ‘</span>
                ${post.view_count || 0}
              </span>
              <span class="text-xs">
                ${formatDate(post.created_at)}
              </span>
            </div>
            
            <!-- Post Actions -->
            <div class="flex items-center gap-4 py-3 border-t border-border">
              <button 
                class="like-btn flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-muted transition-colors ${post.user_liked ? 'text-red-500' : 'text-muted-foreground'}"
                data-post-id="${post.id}"
                onclick="likePost(${post.id})"
              >
                <span class="w-5 h-5">${post.user_liked ? 'â¤ï¸' : 'ğŸ¤'}</span>
                <span class="like-count">${post.like_count || 0}</span>
                <span>Ø¥Ø¹Ø¬Ø§Ø¨</span>
              </button>
              
              <button 
                class="comment-btn flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-muted transition-colors text-muted-foreground"
                data-post-id="${post.id}"
                onclick="toggleComments(${post.id})"
              >
                <span class="w-5 h-5">ğŸ’¬</span>
                <span class="comment-count">${post.comment_count || post.total_comments || 0}</span>
                <span>ØªØ¹Ù„ÙŠÙ‚</span>
              </button>
              
              <button 
                class="share-btn flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-muted transition-colors text-muted-foreground"
                onclick="sharePost(${post.id})"
              >
                <span class="w-5 h-5">ğŸ“¤</span>
                <span>Ù…Ø´Ø§Ø±ÙƒØ©</span>
              </button>
            </div>
            
            <!-- Comments Section -->
            <div class="comments-section hidden mt-4" id="comments-${post.id}">
              <div class="bg-muted/50 rounded-lg p-4">
                <!-- Comment Form -->
                <div class="flex gap-3 mb-4">
                  <div class="w-8 h-8 bg-tactical-green rounded-full flex items-center justify-center text-white text-sm">
                    Ø£
                  </div>
                  <div class="flex-1">
                    <textarea 
                      id="comment-input-${post.id}"
                      placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹..."
                      class="w-full p-3 border border-border rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-tactical-green"
                      rows="2"
                    ></textarea>
                    <div class="flex justify-end mt-2">
                      <button 
                        class="submit-comment-btn px-4 py-2 bg-tactical-green text-white rounded-lg hover:bg-tactical-green/80 transition-colors"
                        data-post-id="${post.id}"
                        onclick="submitComment(${post.id})"
                      >
                        Ù†Ø´Ø±
                      </button>
                    </div>
                  </div>
                </div>
                
                <!-- Comments List -->
                <div class="comments-list" id="comments-list-${post.id}">
                  <!-- Comments will be loaded here -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </article>
    `).join('');
    
    if (replace) {
      recentPostsContainer.innerHTML = postsHtml;
    } else {
      recentPostsContainer.innerHTML += postsHtml;
    }
    
    // Add click handlers for post titles
    document.querySelectorAll('.post-title').forEach(title => {
      title.addEventListener('click', () => {
        const postId = title.getAttribute('data-post-id');
        window.location.href = `/ar/forum/post/${postId}`;
      });
    });
  }

  function renderFeaturedPosts(featuredPosts) {
    const featuredContainer = document.querySelector('#featured-posts-container');
    if (!featuredContainer || featuredPosts.length === 0) return;
    
    const featuredHtml = featuredPosts.map(post => `
      <article class="bg-card border border-border rounded-lg p-6 hover:border-tactical-green/30 transition-colors">
        <div class="flex items-start justify-between mb-4">
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-2">
              <span class="w-4 h-4 text-yellow-500">â­</span>
              <span class="px-2 py-1 text-xs rounded-full" style="background-color: ${post.category_color || '#4F9CF9'}20; color: ${post.category_color || '#4F9CF9'}">
                ${post.category_name || 'Ø¹Ø§Ù…'}
              </span>
            </div>
            
            <h3 class="text-xl font-semibold text-foreground mb-3 cursor-pointer hover:text-tactical-green transition-colors post-title" 
                data-post-id="${post.id}">
              ${post.title}
            </h3>
            
            <p class="text-muted-foreground text-sm mb-4 line-clamp-3">
              ${post.content.substring(0, 300)}...
            </p>
            
            <div class="flex items-center gap-4 text-sm text-muted-foreground">
              <span class="flex items-center gap-1">
                <span class="w-4 h-4">ğŸ‘¤</span>
                ${post.author_username || 'Ù…Ø¬Ù‡ÙˆÙ„'}
              </span>
              <span class="flex items-center gap-1">
                <span class="w-4 h-4">ğŸ‘</span>
                ${post.view_count || 0}
              </span>
              <span class="flex items-center gap-1">
                <span class="w-4 h-4">â¤</span>
                ${post.like_count || 0}
              </span>
              <span class="flex items-center gap-1">
                <span class="w-4 h-4">ğŸ’¬</span>
                ${post.comment_count || post.total_comments || 0}
              </span>
            </div>
          </div>
        </div>
      </article>
    `).join('');
    
    featuredContainer.innerHTML = featuredHtml;
  }

  // Utility functions
  function formatDate(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const diffTime = Math.abs(now - date);
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays === 0) return 'Ø§Ù„ÙŠÙˆÙ…';
    if (diffDays === 1) return 'Ø£Ù…Ø³';
    if (diffDays < 7) return `Ù…Ù†Ø° ${diffDays} Ø£ÙŠØ§Ù…`;
    
    return date.toLocaleDateString('ar-SA');
  }

  function filterByCategory(categoryId) {
    currentPage = 1;
    fetchPosts(1, categoryId, 'latest');
  }

  // Event handlers
  function setupEventListeners() {
    // Search functionality
    const searchInput = document.querySelector('#search-input');
    if (searchInput) {
      let searchTimeout;
      searchInput.addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          currentPage = 1;
          fetchPosts(1, null, 'latest', e.target.value);
        }, 500);
      });
    }

    // New post button
    const newPostBtn = document.querySelector('#new-post-btn');
    if (newPostBtn) {
      newPostBtn.addEventListener('click', () => {
        window.location.href = '/ar/forum/create';
      });
    }
  }
  
  // Render empty state
  function renderEmptyState() {
    const recentPostsContainer = document.querySelector('#recent-posts-container');
    if (!recentPostsContainer) return;
    
    recentPostsContainer.innerHTML = `
      <div class="text-center py-12">
        <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-muted flex items-center justify-center">
          <span class="text-2xl">ğŸ“</span>
        </div>
        <h3 class="text-lg font-medium text-foreground mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø¨Ø¹Ø¯</h3>
        <p class="text-muted-foreground mb-6">ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ´Ø§Ø±Ùƒ ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¯Ù‰!</p>
        <button 
          class="px-6 py-3 bg-tactical-green text-white rounded-lg hover:bg-tactical-green/80 transition-colors"
          onclick="window.location.href='/ar/forum/create_real'"
        >
          Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯
        </button>
      </div>
    `;
  }

  // Post interaction functions
  window.likePost = async function(postId) {
    const token = localStorage.getItem('authToken');
    if (!token) {
      showNotification('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
      return;
    }

    try {
      const response = await fetch('/backend/public/forum_api.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({ 
          action: 'like_post',
          post_id: postId 
        })
      });
      
      const data = await response.json();
      if (data.success) {
        // Update like count in UI
        const increment = data.liked ? 1 : -1;
        updatePostLikeCount(postId, increment, data.liked);
        showNotification(data.liked ? 'ØªÙ… Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø¨Ø§Ù„Ù…Ù†Ø´ÙˆØ±' : 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨', 'success');
      } else {
        showNotification(data.error || 'ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'error');
      }
    } catch (error) {
      console.error('Error liking post:', error);
      showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©', 'error');
    }
  };

  window.fetchComments = async function(postId) {
    try {
      const response = await fetch(`/backend/public/forum_api.php?action=get_comments&post_id=${postId}`);
      const data = await response.json();
      
      if (data.success) {
        const commentsList = document.getElementById(`comments-list-${postId}`);
        if (commentsList) {
          commentsList.innerHTML = data.comments.map(comment => `
            <div class="flex gap-3 mb-4 comment-item" data-comment-id="${comment.id}">
              <div class="w-8 h-8 bg-tactical-green rounded-full flex items-center justify-center text-white text-sm">
                ${comment.author_username ? comment.author_username.charAt(0) : 'Ø£'}
              </div>
              <div class="flex-1">
                <div class="bg-white rounded-lg p-3 border border-border">
                  <div class="flex items-center gap-2 mb-2">
                    <span class="font-medium text-sm">${comment.author_username || 'Ù…Ø¬Ù‡ÙˆÙ„'}</span>
                    <span class="text-xs text-muted-foreground">${formatDate(comment.created_at)}</span>
                  </div>
                  <p class="text-sm">${comment.content}</p>
                </div>
                <div class="flex items-center gap-4 mt-2 text-xs text-muted-foreground">
                  <button class="hover:text-tactical-green transition-colors">Ø¥Ø¹Ø¬Ø§Ø¨</button>
                  <button class="hover:text-tactical-green transition-colors">Ø±Ø¯</button>
                </div>
              </div>
            </div>
          `).join('');
        }
      }
    } catch (error) {
      console.error('Error fetching comments:', error);
    }
  };

  window.sharePost = async function(postId) {
    try {
      const url = `${window.location.origin}/ar/forum/post/${postId}`;
      await navigator.clipboard.writeText(url);
      showNotification('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†Ø´ÙˆØ±', 'success');
    } catch (error) {
      console.error('Error sharing post:', error);
      showNotification('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·', 'error');
    }
  };

  // Toggle comments section
  window.toggleComments = async function(postId) {
    const commentsSection = document.getElementById(`comments-${postId}`);
    if (!commentsSection) return;
    
    if (commentsSection.classList.contains('hidden')) {
      commentsSection.classList.remove('hidden');
      await fetchComments(postId);
    } else {
      commentsSection.classList.add('hidden');
    }
  };
  
  // Submit comment
  window.submitComment = async function(postId) {
    const content = document.getElementById(`comment-input-${postId}`).value.trim();
    if (!content) {
      showNotification('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© ØªØ¹Ù„ÙŠÙ‚ Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø´Ø±', 'warning');
      return;
    }
    
    const token = localStorage.getItem('authToken');
    if (!token) {
      showNotification('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
      return;
    }
    
    try {
      const response = await fetch('/backend/public/forum_api.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
          action: 'create_comment',
          post_id: postId,
          content: content
        })
      });
      
      const result = await response.json();
      if (result.success) {
        document.getElementById(`comment-input-${postId}`).value = '';
        await fetchComments(postId);
        updateCommentCount(postId, 1);
        showNotification('ØªÙ… Ù†Ø´Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­', 'success');
      } else {
        showNotification(result.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù†Ø´Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ‚', 'error');
      }
    } catch (error) {
      console.error('Error submitting comment:', error);
      showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
    }
  };
  
  // Update comment count
  function updateCommentCount(postId, increment) {
    const commentBtn = document.querySelector(`[data-post-id="${postId}"] .comment-count`);
    if (commentBtn) {
      const currentCount = parseInt(commentBtn.textContent) || 0;
      commentBtn.textContent = currentCount + increment;
    }
  }
  
  // Update like count
  function updatePostLikeCount(postId, increment, liked) {
    const likeBtn = document.querySelector(`[data-post-id="${postId}"] .like-btn`);
    if (likeBtn) {
      const likeCount = likeBtn.querySelector('.like-count');
      const likeIcon = likeBtn.querySelector('span');
      
      if (likeCount) {
        const currentCount = parseInt(likeCount.textContent) || 0;
        likeCount.textContent = currentCount + increment;
      }
      
      if (likeIcon) {
        likeIcon.textContent = liked ? 'â¤ï¸' : 'ğŸ¤';
      }
      
      // Update button style
      if (liked) {
        likeBtn.classList.add('text-red-500');
        likeBtn.classList.remove('text-muted-foreground');
      } else {
        likeBtn.classList.remove('text-red-500');
        likeBtn.classList.add('text-muted-foreground');
      }
    }
  }
  
  // Add comment to post
  function addCommentToPost(postId, comment) {
    const commentsList = document.getElementById(`comments-list-${postId}`);
    if (!commentsList) return;
    
    const commentHtml = `
      <div class="flex gap-3 mb-4 comment-item" data-comment-id="${comment.id}">
        <div class="w-8 h-8 bg-tactical-green rounded-full flex items-center justify-center text-white text-sm">
          ${comment.author_username ? comment.author_username.charAt(0) : 'Ø£'}
        </div>
        <div class="flex-1">
          <div class="bg-white rounded-lg p-3 border border-border">
            <div class="flex items-center gap-2 mb-2">
              <span class="font-medium text-sm">${comment.author_username || 'Ù…Ø¬Ù‡ÙˆÙ„'}</span>
              <span class="text-xs text-muted-foreground">${formatDate(comment.created_at)}</span>
            </div>
            <p class="text-sm">${comment.content}</p>
          </div>
          <div class="flex items-center gap-4 mt-2 text-xs text-muted-foreground">
            <button class="hover:text-tactical-green transition-colors">Ø¥Ø¹Ø¬Ø§Ø¨</button>
            <button class="hover:text-tactical-green transition-colors">Ø±Ø¯</button>
          </div>
        </div>
      </div>
    `;
    
    commentsList.insertAdjacentHTML('afterbegin', commentHtml);
  }
  
  // Show notification
  function showNotification(message, type = 'info') {
    // Remove existing notification
    const existingNotification = document.querySelector('.notification');
    if (existingNotification) {
      existingNotification.remove();
    }
    
    const notification = document.createElement('div');
    notification.className = `notification fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${
      type === 'success' ? 'bg-green-500 text-white' : 
      type === 'error' ? 'bg-red-500 text-white' : 
      type === 'warning' ? 'bg-yellow-500 text-white' : 
      'bg-blue-500 text-white'
    }`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    // Auto remove after 3 seconds
    setTimeout(() => {
      notification.remove();
    }, 3000);
  }
  
  // Format date
  function formatDate(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const diffTime = Math.abs(now - date);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays === 1) {
      return 'Ø£Ù…Ø³';
    } else if (diffDays < 7) {
      return `Ù…Ù†Ø° ${diffDays} Ø£ÙŠØ§Ù…`;
    } else {
      return date.toLocaleDateString('ar-SA');
    }
  }

  // Initialize the forum page
  document.addEventListener('DOMContentLoaded', async () => {
    setupEventListeners();
    
    // Check if user is logged in for testing
    if (!localStorage.getItem('authToken')) {
      // Set a test token for development
      localStorage.setItem('authToken', 'test_token_123');
      console.log('Added test auth token for development');
    }
    
    // Load data from API
    await Promise.all([
      fetchForumStats(),
      fetchCategories(),
      fetchPosts()
    ]);
  });
</script> 
